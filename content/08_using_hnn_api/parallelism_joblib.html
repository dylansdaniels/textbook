<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNN Textbook</title>
    <!-- <base href="/textbook/"> -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/styles.css">
    <script src="../../templates/scripts.js" defer></script>
</head>
<body>
    <svg style="display: none;">
        <symbol id="popup-symbol" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="9" 
                fill="var(--fill-color, transparent)" 
                stroke="var(--stroke-color, currentColor)" 
                stroke-width="2" />
            <path d="M9 9L15 15M15 9L9 15" 
                stroke="var(--stroke-color, currentColor)" 
                stroke-width="2" 
                stroke-linecap="round" />
        </symbol>
    </svg>

	<div id="mySidebar" class="sidebar">
		<div class="sidebar-close">
		<svg class="popup-symbol" viewBox="0 0 24 24">
		<use href="#popup-symbol" />
		</svg>
		</div>
		<div class="navbar-header">
		<a>
			Human Neocortical Neurosolver
		</a>
		<br>
			<svg class="collapse-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
				<path d="M9 9H4v1h5V9z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"/>
			</svg>
		</div>
		<a href="/textbook/content/preface.html">Preface</a>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				1. Getting Started
			</a>
			<div class="submenu">
				<a href="/textbook/content/01_getting_started/challenge.html">1.1 Introducing HNN</a>
				<a href="/textbook/content/01_getting_started/template_model.html">1.2 Template Model</a>
				<a href="/textbook/content/01_getting_started/installation.html">1.3 Installation</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				2. Model Assumptions
			</a>
			<div class="submenu">
				<a href="/textbook/content/03_model_assumptions/cortical_column_structure.html">2.1 Cortical Column Structure</a>
				<a href="/textbook/content/03_model_assumptions/primary_electric_currents.html">2.2 Primary Electrical Currents</a>
				<a href="/textbook/content/03_model_assumptions/neurons_morphology_and_physiology.html">2.3 Neurons: Morphology and Physiology</a>
				<a href="/textbook/content/03_model_assumptions/synaptic_connectivity.html">2.4 Synaptic Connectivity</a>
				<a href="/textbook/content/03_model_assumptions/evoked_and_rhythmic_driving_inputs.html">2.5 Evoked and Rhythmic Driving Inputs</a>
				<a href="/textbook/content/03_model_assumptions/tonic_and_noisy_driving_inputs.html">2.6 Tonic and Noisy Driving Inputs</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				3. Using the HNN GUI
			</a>
			<div class="submenu">
				<a href="/textbook/content/04_using_hnn_gui/gui_quickstart.html">3.1 GUI Quickstart</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				4. Simulating ERPs
			</a>
			<div class="submenu">
				<a href="/textbook/content/05_erps/erps_in_gui.html">4.1 GUI Tutorial of ERPs Simulation</a>
				<a href="/textbook/content/05_erps/hnn_core.html">4.2 API Tutorial of ERPs Simulation</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				5. Simulating Alpha/Beta Rhythms
			</a>
			<div class="submenu">
				<a href="/textbook/content/06_alpha_beta/gui.html">5.1 GUI Tutorial of Alpha/Beta Rhythms</a>
				<a href="/textbook/content/06_alpha_beta/api.html">5.2 API Tutorial of Alpha/Beta Rhythms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				6. Simulating Gamma Rhythms
			</a>
			<div class="submenu">
				<a href="/textbook/content/07_gamma/gamma_in_gui.html">6.1 GUI Tutorial of Gamma Rhythms</a>
				<a href="/textbook/content/07_gamma/gamma_in_api.html">6.2 API Tutorial of Gamma Rhythms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				7. Using the HNN API
			</a>
			<div class="submenu">
				<a href="/textbook/content/08_using_hnn_api/plot_firing_pattern.html">7.1 Plot Firing Pattern</a>
				<a href="/textbook/content/08_using_hnn_api/record_and_plot_extracellular_potentials.html">7.2 Record & Plot Extracellular Potentials</a>
				<a href="/textbook/content/08_using_hnn_api/modifying_local_connectivity.html">7.3 Modifying Local Connectivity</a>
				<a href="/textbook/content/08_using_hnn_api/animating_hnn_simulations.html">7.4 Animating HNN Simulations</a>
				<a href="/textbook/content/08_using_hnn_api/batch_simulation.html">7.5 Batch Simulation</a>
				<a href="/textbook/content/08_using_hnn_api/simulate_beta_modulated_erp.html">7.6 Simulate Beta-modulated ERP</a>
				<a href="/textbook/content/08_using_hnn_api/parallelism_joblib.html">7.7 Parallelism: Joblib</a>
				<a href="/textbook/content/08_using_hnn_api/parallelism_mpi.html">7.8 Parallelism: MPI</a>
				<a href="/textbook/content/08_using_hnn_api/optimize_simulated_evoked_response_parameters.html">7.9 Optimize simulated evoked response parameters</a>
				<a href="/textbook/content/08_using_hnn_api/optimize_simulated_rhythmic_response_parameters.html">7.10 Optimize simulated rhythmic response parameters</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				8. From Data to Simulation
			</a>
			<div class="submenu">
				<a href="/textbook/content/09_data_to_simulation/from_meg_to_hnn.html">8.1 From MEG sensor-space data to HNN simulation</a>
			</div>
		</div>
	<div style='height: 30px;'></div>
	</div>


    <div class="topbar">
        
        <!-- Topbar menu -->
        <div class="menu-container">
            <div class="menu-icons">
                <button class="openbtn" onclick="toggleNav()">
                    â˜°
                </button>
                <a href="https://hnn.brown.edu" class="home-link">
                    <div class="home-icon-container">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24" 
                            height="24"
                            viewBox="0 0 24 24" 
                            class="home-icon">
                            <path
                                d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"
                            />
                        </svg>
                    </div>
                </a>
                <button class="theme-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
                    </svg>
                </button>
                <div class="dropdown">
                    <button 
                        id="dropdownButton" 
                        class="dropdown-button">
                            <img
                                src="/textbook/content/assets/icons/fontsize.png"
                                alt="fontsize"
                            />
                    </button>
                    <div class="dropdown-content">
                        <button 
                            class="fontsize-btn" 
                            onclick="decreaseFontSize()">
                            <img
                                src="/textbook/content/assets/icons/fontminus.png"
                                alt="fontminus"
                            />
                        </button>
                        <button 
                            class="fontsize-btn" 
                            onclick="increaseFontSize()">
                            <img
                                src="/textbook/content/assets/icons/fontplus.png"
                                alt="fontplus"
                            />
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Topbar image -->
        <div class="topbar-logo-container">
            <img 
                id="topbar-logo"
                src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/frontpage/logos/logo-hnn-medium.png"
            />
        </div>

        <!-- Right side of topbar -->
        <div class="socials-container">
            <div class="social-icons">
                <a 
                    href="https://github.com/jonescompneurolab/hnn-core" 
                    target="_blank" 
                    aria-label="GitHub">
                    <img 
                        src="/textbook/content/assets/icons/github.png"
                        alt="GitHub">
                </a>
                <a 
                    href="https://bsky.app/profile/hnnsolver.bsky.social" 
                    target="_blank"
                    aria-label="BlueSky">
                    <img 
                        src="/textbook/content/assets/icons/bluesky.png"
                        alt="BlueSky">
                </a>
                <a 
                    href="https://www.linkedin.com/company/human-neocortical-neurosolver/" 
                    target="_blank"
                    aria-label="LinkedIn">
                    <img 
                        src="/textbook/content/assets/icons/linkedin.png"
                        alt="LinkedIn">
                </a>
            </div>
        </div>
    </div>

    <div id="main">
    <div id="content-wrapper">
    <div id="content">

<!--
# Title: 7.7 Parallelism: Joblib
# Updated: 2025-02-04
#
# Contributors:
    # Dylan Daniels
    # Mainak Jas <mmjas@mgh.harvard.edu>
    # Sam Neymotin <samnemo@gmail.com>
    # Blake Caldwell <blake_caldwell@brown.edu>
    # Christopher Bailey <cjb@cfin.au.dk>
-->

        <div class="notebook-download-wrapper">
            <a href='parallelism_joblib_notebook.ipynb' download>
                <button class="notebook-download">
                    <svg xmlns="http://www.w3.org/2000/svg" 
                        width="20" height="20" viewBox="0 0 24 24" fill="none" 
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <span style="width: 8px"></span>
                    <span>Download Notebook</span>
                </button>
            </a>
        </div>

    
<div class='markdown-cell'>
    <h1>7.7: Parallelism: Using the Joblib backend</h1>
<p>This example demonstrates how to use the Joblib backend for
simulating dipoles using <code>hnn_core</code>.</p>
<p><code>hnn_core</code> can take advantage of <a
href="https://joblib.readthedocs.io/en/stable/">the Joblib library</a>
to run <strong>multiple</strong> independent simulations simultaneously
across <strong>multiple</strong> CPU processors. This is an example of
<a
href="https://en.wikipedia.org/wiki/Embarrassingly_parallel">"embarrassingly
parallel" processing jobs</a>. In HNN, this is commonly done if you want
to run many "trials" of the same simulation. Since each trial simulation
is fully independent of the other trial simulations, each trial
simulation can be run on its own CPU core. Joblib parallelism is
particularly useful if you are using <a
href="https://jonescompneurolab.github.io/textbook/content/08_using_hnn_api/batch_simulation.html">batch
simulation to explore parameter spaces</a>.</p>
<p>Note that to use Joblib parallelism, you need either the
<code>conda</code> install or the <code>pip</code>
<code>Joblib Installation</code> dependencies described <a
href="https://jonescompneurolab.github.io/textbook/content/01_getting_started/installation.html">in
our Installation Guide here</a>.</p>
<p>Note that Joblib parallelism is distinct from <code>hnn_core</code>'s
use of <a
href="https://jonescompneurolab.github.io/textbook/content/08_using_hnn_api/parallelism_mpi.html">MPI
parallelism, which can be found here</a>.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        # Authors: Mainak Jas <mjas@mgh.harvard.edu>
#          Blake Caldwell <blake_caldwell@brown.edu>
#          Austin Soplata <austin_soplata@brown.edu>
    </code>
</div>
<div class='markdown-cell'>
    <p>Let us import what we need from <code>hnn_core</code>:</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        import matplotlib.pyplot as plt

from hnn_core import simulate_dipole, jones_2009_model
from hnn_core.viz import plot_dipole
    </code>
</div>
<div class='markdown-cell'>
    <p>Following our <a
href="https://jonescompneurolab.github.io/textbook/content/06_alpha_beta/api.html">Alpha
example</a>, we will create our network and add a ~10 Hz "bursty"
drive:</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        net = jones_2009_model()

weights_ampa = {'L2_pyramidal': 5.4e-5, 'L5_pyramidal': 5.4e-5}
net.add_bursty_drive(
    'bursty', tstart=50., burst_rate=10, burst_std=20., numspikes=2,
    spike_isi=10, n_drive_cells=10, location='distal',
    weights_ampa=weights_ampa, event_seed=278)
    </code>
</div>
<div class='markdown-cell'>
    <p>Finally, we will simulate using the <a
href="https://jonescompneurolab.github.io/hnn-core/dev/generated/hnn_core.parallel_backends.JoblibBackend.html#hnn_core.parallel_backends.JoblibBackend"><code>JoblibBackend</code>
class</a>. You can control the number of CPU cores to use via
<code>n_jobs</code>, while the number of total trials to be run can be
specified by <code>n_trials</code>. Note that these numbers do NOT have
to match: you can ask for more trials than there are jobs available, and
Joblib will simply execute later jobs after the first batch has
completed.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        from hnn_core import JoblibBackend

with JoblibBackend(n_jobs=4):
    dpls = simulate_dipole(net, tstop=210., n_trials=6)
    </code>
</div>
<div class='output-cell'><div class='output-label'>
    Out:
</div>
    <div class='output-code'>
        Joblib will run 6 trial(s) in parallel by distributing trials over 4 jobs.

        Loading custom mechanism files from /usr/share/miniconda/envs/textbook-env-mpi/lib/python3.12/site-packages/hnn_core/mod/x86_64/libnrnmech.so
Building the NEURON model
Loading custom mechanism files from /usr/share/miniconda/envs/textbook-env-mpi/lib/python3.12/site-packages/hnn_core/mod/x86_64/libnrnmech.so
Building the NEURON model
Loading custom mechanism files from /usr/share/miniconda/envs/textbook-env-mpi/lib/python3.12/site-packages/hnn_core/mod/x86_64/libnrnmech.so
Building the NEURON model
Loading custom mechanism files from /usr/share/miniconda/envs/textbook-env-mpi/lib/python3.12/site-packages/hnn_core/mod/x86_64/libnrnmech.so
Building the NEURON model

        [Done]
[Done]
[Done]
Trial 3: 0.03 ms...
Trial 2: 0.03 ms...
Trial 1: 0.03 ms...
[Done]
Trial 4: 0.03 ms...

        Trial 2: 10.0 ms...Trial 3: 10.0 ms...

Trial 1: 10.0 ms...
Trial 4: 10.0 ms...

        Trial 2: 20.0 ms...
Trial 3: 20.0 ms...
Trial 1: 20.0 ms...
Trial 4: 20.0 ms...

        Trial 2: 30.0 ms...
Trial 1: 30.0 ms...
Trial 3: 30.0 ms...
Trial 4: 30.0 ms...

        Trial 2: 40.0 ms...
Trial 3: 40.0 ms...
Trial 1: 40.0 ms...

        Trial 4: 40.0 ms...

        Trial 2: 50.0 ms...
Trial 3: 50.0 ms...
Trial 1: 50.0 ms...

        Trial 4: 50.0 ms...

        Trial 2: 60.0 ms...
Trial 3: 60.0 ms...
Trial 1: 60.0 ms...

        Trial 4: 60.0 ms...

        Trial 2: 70.0 ms...
Trial 3: 70.0 ms...
Trial 1: 70.0 ms...

        Trial 4: 70.0 ms...

        Trial 3: 80.0 ms...
Trial 2: 80.0 ms...

        Trial 4: 80.0 ms...
Trial 1: 80.0 ms...

        Trial 3: 90.0 ms...

        Trial 2: 90.0 ms...
Trial 4: 90.0 ms...
Trial 1: 90.0 ms...

        Trial 3: 100.0 ms...

        Trial 4: 100.0 ms...
Trial 1: 100.0 ms...
Trial 2: 100.0 ms...

        Trial 3: 110.0 ms...

        Trial 4: 110.0 ms...
Trial 1: 110.0 ms...
Trial 2: 110.0 ms...

        Trial 3: 120.0 ms...

        Trial 4: 120.0 ms...
Trial 2: 120.0 ms...
Trial 1: 120.0 ms...

        Trial 3: 130.0 ms...

        Trial 4: 130.0 ms...
Trial 2: 130.0 ms...
Trial 1: 130.0 ms...

        Trial 3: 140.0 ms...

        Trial 4: 140.0 ms...
Trial 2: 140.0 ms...
Trial 1: 140.0 ms...

        Trial 3: 150.0 ms...

        Trial 2: 150.0 ms...
Trial 4: 150.0 ms...
Trial 1: 150.0 ms...

        Trial 3: 160.0 ms...

        Trial 2: 160.0 ms...
Trial 4: 160.0 ms...

        Trial 1: 160.0 ms...

        Trial 3: 170.0 ms...

        Trial 2: 170.0 ms...
Trial 4: 170.0 ms...

        Trial 1: 170.0 ms...

        Trial 3: 180.0 ms...

        Trial 2: 180.0 ms...

        Trial 4: 180.0 ms...
Trial 1: 180.0 ms...

        Trial 3: 190.0 ms...

        Trial 2: 190.0 ms...

        Trial 4: 190.0 ms...
Trial 1: 190.0 ms...

        Trial 3: 200.0 ms...

        Trial 2: 200.0 ms...

        Trial 4: 200.0 ms...
Trial 1: 200.0 ms...

        Building the NEURON model

        Building the NEURON model

        [Done]
Trial 5: 0.03 ms...
[Done]
Trial 6: 0.03 ms...

        Trial 5: 10.0 ms...

        Trial 6: 10.0 ms...

        Trial 5: 20.0 ms...

        Trial 6: 20.0 ms...

        Trial 5: 30.0 ms...

        Trial 6: 30.0 ms...

        Trial 5: 40.0 ms...

        Trial 6: 40.0 ms...

        Trial 5: 50.0 ms...

        Trial 6: 50.0 ms...

        Trial 5: 60.0 ms...

        Trial 6: 60.0 ms...

        Trial 5: 70.0 ms...

        Trial 6: 70.0 ms...

        Trial 5: 80.0 ms...

        Trial 6: 80.0 ms...

        Trial 5: 90.0 ms...

        Trial 6: 90.0 ms...

        Trial 5: 100.0 ms...

        Trial 6: 100.0 ms...

        Trial 5: 110.0 ms...

        Trial 6: 110.0 ms...

        Trial 5: 120.0 ms...

        Trial 6: 120.0 ms...

        Trial 5: 130.0 ms...

        Trial 6: 130.0 ms...

        Trial 5: 140.0 ms...

        Trial 6: 140.0 ms...

        Trial 5: 150.0 ms...

        Trial 6: 150.0 ms...
Trial 5: 160.0 ms...

        Trial 6: 160.0 ms...
Trial 5: 170.0 ms...

        Trial 6: 170.0 ms...
Trial 5: 180.0 ms...

        Trial 6: 180.0 ms...
Trial 5: 190.0 ms...

        Trial 5: 200.0 ms...
Trial 6: 190.0 ms...

        Trial 6: 200.0 ms...

    </div>
</div>
<div class='code-cell'>
    <code class='language-python'>
        plot_dipole(dpls, show=False)
plt.show()
    </code>
</div>
<div class='output-cell'><div class='output-label'>
    Out:
</div>
    <div class='output-code'>
        &lt;Figure size 640x480 with 1 Axes&gt;
    </div>
</div>
<div class='output-cell'>
    <img src='output_nb_parallelism_joblib_notebook/fig_01.png'/>
</div>
        <!-- footer area -->
        <!----------------->
        <div class="footer-area">
            <div class="previous-area" data-link="/textbook/content/08_using_hnn_api/simulate_beta_modulated_erp.html">
                <div class="previous-icon">
                    <svg class="svg-arrow" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path class="arrow-path" d="M15 5L9 12L15 19" />
                    </svg>
                </div>
                <div class="previous-text">
                    <p>Previous</p>
                    <a>7.6 Simulate Beta-modulated ERP</a>
                </div>
            </div>
            <div class="next-area" data-link="/textbook/content/08_using_hnn_api/parallelism_mpi.html">
                <div class="next-text">
                    <p>Next</p>
                    <a>7.8 Parallelism: MPI</a>
                </div>
                <div class="next-icon">
                    <svg class="svg-arrow" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path class="arrow-path" d="M15 5L9 12L15 19" />
                    </svg>
                </div>
            </div>
        </div> <!-- close footer -->
    </div> <!-- close content -->
    </div> <!-- close content wrapper -->
</div> <!-- close main --><!------------------------ #
# Code syntax highlighting #
# ------------------------->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />


</body>
</html>