{
    "full_executed": true,
    "hnn_version": "0.5.0",
    "parallelism_joblib_notebook.ipynb": {
        "7.7: Parallelism: Using the Joblib backend": {
            "level": 1,
            "html": "                <div class='markdown-cell'>\n                    <h1>7.7: Parallelism: Using the Joblib backend</h1>\n<p>This example demonstrates how to use the Joblib backend for\nsimulating dipoles using <code>hnn_core</code>.</p>\n<p><code>hnn_core</code> can take advantage of <a\nhref=\"https://joblib.readthedocs.io/en/stable/\">the Joblib library</a>\nto run <strong>multiple</strong> independent simulations simultaneously\nacross <strong>multiple</strong> CPU processors. This is an example of\n<a\nhref=\"https://en.wikipedia.org/wiki/Embarrassingly_parallel\">\"embarrassingly\nparallel\" processing jobs</a>. In HNN, this is commonly done if you want\nto run many \"trials\" of the same simulation. Since each trial simulation\nis fully independent of the other trial simulations, each trial\nsimulation can be run on its own CPU core. Joblib parallelism is\nparticularly useful if you are using <a\nhref=\"https://jonescompneurolab.github.io/textbook/content/08_using_hnn_api/batch_simulation.html\">batch\nsimulation to explore parameter spaces</a>.</p>\n<p>Note that to use Joblib parallelism, you need either the\n<code>conda</code> install or the <code>pip</code>\n<code>Joblib Installation</code> dependencies described <a\nhref=\"https://jonescompneurolab.github.io/textbook/content/01_getting_started/installation.html\">in\nour Installation Guide here</a>.</p>\n<p>Note that Joblib parallelism is distinct from <code>hnn_core</code>'s\nuse of <a\nhref=\"https://jonescompneurolab.github.io/textbook/content/08_using_hnn_api/parallelism_mpi.html\">MPI\nparallelism, which can be found here</a>.</p>\n\n                </div>\n\n\n                <!-- code cell -->\n                <div class='code-cell'>\n                    <code class='language-python'>\n                        # Authors: Mainak Jas <mjas@mgh.harvard.edu>\n#          Blake Caldwell <blake_caldwell@brown.edu>\n#          Austin Soplata <austin_soplata@brown.edu>\n                    </code>\n                </div>\n\n\n<!-- markdown cell -->\n<div class='markdown-cell'>\n    <p>Let us import what we need from <code>hnn_core</code>:</p>\n\n</div>\n\n\n                <!-- code cell -->\n                <div class='code-cell'>\n                    <code class='language-python'>\n                        import matplotlib.pyplot as plt\n\nfrom hnn_core import simulate_dipole, jones_2009_model\nfrom hnn_core.viz import plot_dipole\n                    </code>\n                </div>\n\n\n                <!-- markdown cell -->\n                <div class='markdown-cell'>\n                    <p>Following our <a\nhref=\"https://jonescompneurolab.github.io/textbook/content/06_alpha_beta/api.html\">Alpha\nexample</a>, we will create our network and add a ~10 Hz \"bursty\"\ndrive:</p>\n\n                </div>\n\n\n                <!-- code cell -->\n                <div class='code-cell'>\n                    <code class='language-python'>\n                        net = jones_2009_model()\n\nweights_ampa = {'L2_pyramidal': 5.4e-5, 'L5_pyramidal': 5.4e-5}\nnet.add_bursty_drive(\n    'bursty', tstart=50., burst_rate=10, burst_std=20., numspikes=2,\n    spike_isi=10, n_drive_cells=10, location='distal',\n    weights_ampa=weights_ampa, event_seed=278)\n                    </code>\n                </div>\n\n\n                <!-- markdown cell -->\n                <div class='markdown-cell'>\n                    <p>Finally, we will simulate using the <a\nhref=\"https://jonescompneurolab.github.io/hnn-core/dev/generated/hnn_core.parallel_backends.JoblibBackend.html#hnn_core.parallel_backends.JoblibBackend\"><code>JoblibBackend</code>\nclass</a>. You can control the number of CPU cores to use via\n<code>n_jobs</code>, while the number of total trials to be run can be\nspecified by <code>n_trials</code>. Note that these numbers do NOT have\nto match: you can ask for more trials than there are jobs available, and\nJoblib will simply execute later jobs after the first batch has\ncompleted.</p>\n\n                </div>\n\n\n                <!-- code cell -->\n                <div class='code-cell'>\n                    <code class='language-python'>\n                        from hnn_core import JoblibBackend\n\nwith JoblibBackend(n_jobs=4):\n    dpls = simulate_dipole(net, tstop=210., n_trials=6)\n                    </code>\n                </div>\n\n\n                <!-- code cell output -->\n                <div class='output-cell'>\n                    <div class='output-label'>\n                        Out:\n                    </div>\n                    <div class='output-code'>\n\n        Joblib will run 6 trial(s) in parallel by distributing trials over 4 jobs.\n\n                    </div>\n                </div>\n\n\n                <!-- code cell -->\n                <div class='code-cell'>\n                    <code class='language-python'>\n                        plot_dipole(dpls, show=False)\nplt.show()\n                    </code>\n                </div>\n\n\n                <!-- code cell output -->\n                <div class='output-cell'>\n                    <div class='output-label'>\n                        Out:\n                    </div>\n                    <div class='output-code'>\n\n        &lt;Figure size 640x480 with 1 Axes&gt;\n                    </div>\n                </div>\n\n\n<!-- code cell image -->\n<div class='output-cell'>\n    <img src='output_nb_parallelism_joblib_notebook/fig_01.png'/>\n</div>"
        }
    }
}